# This file was autogenerated by TPVConfigLinter for mypy checks.
import logging
import typing
from typing import Annotated, Any, ClassVar, Iterable

from galaxy.app import UniverseApplication
from galaxy.jobs import JobWrapper
from galaxy.model import Job, User
from galaxy.tools import Tool as GalaxyTool

from tpv.core import helpers
from tpv.core.entities import Destination, Entity, SchedulingTags
from tpv.core.mapper import EntityToDestinationMapper

log = logging.getLogger(__name__)

# --- 1. Declare global "context" variables ---
app: UniverseApplication
tool: GalaxyTool
user: User | None
job: Job
job_wrapper: JobWrapper | None
resource_params: dict[str, Any] | None
workflow_invocation_uuid: str | None
mapper: EntityToDestinationMapper
entity: Entity

# --- 2. Declare evaluation time "context" variables ---
cores: int | float | str | None
mem: int | float | str | None
gpus: int | str | None
min_cores: int | float | str | None
min_mem: int | float | str | None
min_gpus: int | str | None
max_cores: int | float | str | None
max_mem: int | float | str | None
max_gpus: int | str | None
max_accepted_cores: int | float | None
max_accepted_mem: int | float | None
max_accepted_gpus: int | None
min_accepted_cores: int | float | None
min_accepted_mem: int | float | None
min_accepted_gpus: int | None
env: list[dict[str, str]] | None
params: dict[str, Any] | None
resubmit: dict[str, Any] | None
rank: str | None
context: dict[str, Any] | None
handler_tags: SchedulingTags | None
candidate_destinations: list[Destination]
dest_name: str | None
input_size: float

# --- 3. Declare user defined "context" variables ---
{% for context_var, context_var_types in context_vars.items() -%}
{{ context_var }}: {{ context_var_types }}
{% endfor %}

# --- 4. User defined, evaluable entity fields ---
{% for block in code_blocks %}
{% if block.return_type == "None" -%}
{# No return_type, like execute or fail fields. Just insert the block -#}
def {{ block.func_name }}() -> None:
    {{ block.code|indent(4) }}
{% else -%}
def {{ block.func_name }}() -> {{ block.return_type }}:
    {# add a return to the last statement in the code block -#}
    {{ block.code|returnify|indent(4) }}
{% endif -%}
{% endfor %}
